<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Добавление задачи</title>
  </head>
  <body>
    <form action="/tasks/store" id="form" method="post">
      <p>
        <input
          type="text"
          name="name"
          id="name"
          placeholder="Краткое описание задачи"
          required
        />
      </p>

      <textarea
        name="description"
        id="description"
        cols="50"
        rows="20"
        placeholder="Описание задачи"
        required
      ></textarea>
      <p>
        <label for="priority">Приоритет</label>
        <select name="priority" id="priority">
          <option value="Высокий">Высокий</option>
          <option value="Средний" selected>Средний</option>
          <option value="Низкий">Низкий</option>
        </select>
      </p>
      <p>
        <label for="user">На кого назначить</label>
        <input
          type="text"
          name="user"
          id="user"
          placeholder="Имя пользователя"
        />
      </p>

      <p><button type="submit">Создать задачу</button></p>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      let socket = io();

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        let form = document.getElementById("form");
        let name = document.getElementById("name");
        let description = document.getElementById("description");
        let priority = document.getElementById("priority");
        let user = document.getElementById("user");

        let obj = {
          name: name.value,
          description: description.value,
          priority: priority.value,
          user: user.value,
        };

        let response = await fetch("/api/v1/task/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
          },
          body: JSON.stringify(obj),
        });

        let result = await response.json();

        if (result.status === "ok") {
          socket.emit("creating task", obj);
        }
      });
    </script>
  </body>
</html>
